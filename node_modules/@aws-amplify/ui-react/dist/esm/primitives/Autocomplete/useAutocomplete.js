import*as e from"react";import{ARROW_UP as t,ARROW_DOWN as o,ENTER_KEY as n,ESCAPE_KEY as l}from"../shared/constants.js";import{isFunction as s}from"../shared/utils.js";import{useStableId as i}from"../utils/useStableId.js";const c=new Set([o,t,n,l]),a=({defaultValue:a="",value:u,options:r,optionFilter:d,onBlur:m,onChange:f,onClear:h,onClick:p,onSelect:g,onSubmit:b})=>{const C=void 0!==u,[I,v]=e.useState(a),k=C?u:I,[w,O]=e.useState(!1),[B,E]=e.useState(null),y=s(d),S=e.useMemo((()=>{const e=y?e=>d(e,k):e=>{const{label:t}=e;return null==t?void 0:t.toLocaleLowerCase().includes(null==k?void 0:k.toLocaleLowerCase())};return(null==r?void 0:r.filter(e))||[]}),[k,d,y,r]),T=i(),H=i(),L=i(),M=i(),V=S.findIndex((e=>e===B)),j=(null==B?void 0:B.id)||(-1!==V?`${M}-option-${V}`:void 0),x=e.useCallback((e=>{O(!1),E(null),s(m)&&m(e)}),[m]),D=e.useCallback((e=>{E(null),O(!0),C||v(e.target.value),s(f)&&f(e)}),[C,f]),F=e.useCallback((()=>{C||v(""),s(h)&&h()}),[C,h]),R=e.useCallback((e=>{O(!0),s(p)&&p(e)}),[p]);return e.useEffect((()=>{const e=document.getElementById(T),t=document.getElementById(L);if(t&&w){const{bottom:o}=t.getBoundingClientRect(),{offsetParent:n,offsetTop:l}=e;n===document.body&&o>document.documentElement.clientHeight&&window.scrollTo({top:Math.min(o-document.documentElement.clientHeight+window.scrollY+20,l),behavior:"smooth"})}}),[T,w,L]),e.useEffect((()=>{const e=document.getElementById(H),t=document.getElementById(j);if(t&&e){const{scrollTop:o,clientHeight:n}=e,{offsetHeight:l,offsetTop:s}=t,{top:i,bottom:c}=t.getBoundingClientRect();o>s&&(e.scrollTop=s),o+n<s+l&&(e.scrollTop=s+l-n),(i<0||c>document.documentElement.clientHeight)&&t.scrollIntoView({behavior:"smooth",block:"nearest"})}}),[j,H]),{activeOptionId:j,autocompleteId:T,composedValue:k,filteredOptions:S,handleOnBlur:x,handleOnClear:F,handleOnClick:R,handleOnChange:D,handleOnKeyDown:e=>{const{key:i}=e;if(c.has(i))switch(e.preventDefault(),i){case l:w?(O(!1),E(null)):F();break;case n:if(B){const{label:e}=B;C||v(e),s(g)&&g(B)}else s(b)&&b(k);O(!1),E(null);break;case o:{if(S.length<=0)return;O(!0);const e=V>=S.length-1?0:V+1;E(S[e]);break}case t:{if(S.length<=0)return;O(!0);const e=V<=0?S.length-1:V-1;E(S[e])}}},isControlled:C,isCustomFiltering:y,isMenuOpen:w,listboxId:H,menuId:L,optionBaseId:M,setActiveOption:E,setIsMenuOpen:O,setInternalValue:v}};export{a as useAutocomplete};
