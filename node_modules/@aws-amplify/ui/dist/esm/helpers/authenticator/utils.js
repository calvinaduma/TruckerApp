import{__awaiter as t,__generator as n}from"tslib";import{Hub as e}from"aws-amplify";import{waitFor as r}from"xstate/lib/waitFor";import{ALLOWED_SPECIAL_CHARACTERS as a}from"./constants.js";import{getActorState as o}from"./actor.js";var u=function(t){for(var n=t.trim().split(""),e=0;e<n.length;e++)e>0&&e<n.length-1&&(n[e]="*");return n.join("")},i=function(t){if(t.length<4)return t;for(var n=t.split(""),e=0;e<n.length-4;e++)n[e]="*";return n.join("")},c=function(e){return t(void 0,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,r(e,(function(t){return o(t).matches("autoSignIn")}))];case 1:case 2:return t.sent(),[3,3];case 3:return[2]}}))}))},s=function(e,r){return t(void 0,void 0,void 0,(function(){var t,a,u,i;return n(this,(function(n){switch(n.label){case 0:switch(t=r.send,a=r.getSnapshot(),e.payload.event){case"tokenRefresh":return[3,1];case"autoSignIn":return[3,2];case"autoSignIn_failure":return[3,5];case"signOut":case"tokenRefresh_failure":return[3,7]}return[3,8];case 1:return a.matches("authenticated.idle")&&t("TOKEN_REFRESH"),[3,9];case 2:return a.matches("authenticated")?[3,4]:[4,c(r)];case 3:n.sent(),(null==(u=o(r.getSnapshot()))?void 0:u.matches("autoSignIn"))&&t({type:"AUTO_SIGN_IN",data:e.payload.data}),n.label=4;case 4:return[3,9];case 5:return[4,c(r)];case 6:return n.sent(),(null==(i=o(r.getSnapshot()))?void 0:i.matches("autoSignIn"))&&t({type:"AUTO_SIGN_IN_FAILURE",data:e.payload.data}),[3,9];case 7:return a.matches("authenticated.idle")&&t("SIGN_OUT"),[3,9];case 8:return[3,9];case 9:return[2]}}))}))},h=function(t,n){return void 0===n&&(n=s),e.listen("auth",function(t,n){return function(e){n(e,t)}}(t,n),"authenticator-hub-handler")},l=function(t){return a.some((function(n){return t.includes(n)}))},f=function(t,n,e){return encodeURI("otpauth://totp/".concat(t,":").concat(n,"?secret=").concat(e,"&issuer=").concat(t))};export{u as censorAllButFirstAndLast,i as censorPhoneNumber,s as defaultAuthHubHandler,f as getTotpCodeURL,l as hasSpecialChars,h as listenToAuthHub};
